/****************************************************************************************************************************************************************
 * @file         : /Code/ClassWork/0805/demo4/main.c
 * @brief        : 小练习：使用栈检查括号匹配
 * @author       : a_23456@foxmail.com
 * @date         : 2024-08-05 15:45:15
 * @version      : 1.0
 * @note         : 实现一个简单的栈结构用于检查括号是否匹配
 * @Copyright    : (c)   2024-2025   a_23456@foxmail.com   All Rights Reserved
 *****************************************************************************************************************************************************************/

#include <stdio.h>
#include <stdlib.h>

// 栈结构体定义
struct Stack {
  int max_size;  // 栈的最大容量
  int top;       // 栈顶指针（指向当前栈顶的索引）
  int *elements; // 存储栈元素的数组
};

/****************************************************************************************************************************************************************
 * @name:        init_stack
 * @brief:       初始化栈
 * @param {Stack} *stack: 指向栈结构体的指针
 * @param {int} max_size: 栈的最大容量
 * @return:       无
 * @date:        2024-08-05 15:45:15
 * @version:     1.0
 * @note:        初始化栈的容量、栈顶指针，并分配内存
 *****************************************************************************************************************************************************************/
void init_stack(struct Stack *stack, int max_size) {
  stack->max_size = max_size;
  stack->top = 0;
  stack->elements = malloc(sizeof(int) * max_size);
  if (stack->elements == NULL) {
    perror("内存分配失败");
    exit(EXIT_FAILURE);
  }
}

/****************************************************************************************************************************************************************
 * @name:        push
 * @brief:       将元素压入栈中
 * @param {Stack} *stack: 指向栈结构体的指针
 * @param {int} value: 要压入栈中的值
 * @return:       无
 * @date:        2024-08-05 15:45:15
 * @version:     1.0
 * @note:        将值压入栈中，如果栈已满则提示失败
 *****************************************************************************************************************************************************************/
void push(struct Stack *stack, int value) {
  if (stack->top >= stack->max_size) {
    printf("入栈失败，栈已满！\n");
    return;
  }
  stack->elements[stack->top++] = value;
}

/****************************************************************************************************************************************************************
 * @name:        pop
 * @brief:       从栈中弹出元素
 * @param {Stack} *stack: 指向栈结构体的指针
 * @return:       弹出的栈元素值，如果栈为空则返回 -1
 * @date:        2024-08-05 15:45:15
 * @version:     1.0
 * @note:        弹出栈顶元素并返回，如果栈为空则返回 -1
 *****************************************************************************************************************************************************************/
int pop(struct Stack *stack) {
  if (stack->top <= 0) {
    printf("出栈失败，栈为空！\n");
    return -1;
  }
  return stack->elements[--stack->top];
}
/****************************************************************************************************************************************************************
 * @name:        free_stack
 * @brief:       释放栈的内存
 * @param {Stack} *stack: 指向栈结构体的指针
 * @return:       无
 * @date:        2024-08-05 15:45:15
 * @version:     1.0
 * @note:        释放栈中元素的内存并重置栈的属性
 *****************************************************************************************************************************************************************/
void free_stack(struct Stack *stack) {
  free(stack->elements);  // 释放栈元素数组的内存
  stack->elements = NULL; // 指针置为空
  stack->top = 0;         // 重置栈顶指针
  stack->max_size = 0;    // 重置栈最大容量
}

int main(int argc, const char *argv[]) {
  struct Stack stack;
  init_stack(&stack, 100); // 初始化栈，设置最大容量为 100

  const char *str = "{{{fsefkjh{f}}eskfs}fsejfsa}";

  // 遍历字符串中的每个字符
  while (*str != '\0') {
    if (*str == '{' || *str == '(' || *str == '[') {
      push(&stack, *str); // 遇到左括号，入栈
    } else if ((*str == '}' && pop(&stack) != '{') ||
               (*str == ')' && pop(&stack) != '(') ||
               (*str == ']' && pop(&stack) != '[')) {
      printf("括号不匹配！");
      return 0;
    }
    str++;
  }
  printf("括号完全匹配！");
  free_stack(&stack); // 释放栈的内存

  return 0; // 程序正常结束
}
