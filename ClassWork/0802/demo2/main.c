/****************************************************************************************************************************************************************
 * @file         : /Code/ClassWork/0802/demo2/main.c
 * @brief        : 双向循环链表的示例程序
 * @author       : a_23456@foxmail.com
 * @date         : 2024-08-03 13:50:58
 * @version      : 1.0
 * @note         :
 * @Copyright    : (c)   2024-2025   a_23456@foxmail.com   All Right Reserved
 *****************************************************************************************************************************************************************/

#include "kernel_list.h"
#include <stdio.h>
#include <stdlib.h>

/****************************************************************************************************************************************************************
 * @name: struct node
 * @brief: 定义链表节点结构
 * @date: 2024-08-03 14:51:37
 * @version: 1.0
 * @note:
 *****************************************************************************************************************************************************************/
struct node {
  int value;             // 节点的值
  struct list_head list; // 内核链表节点
};

/****************************************************************************************************************************************************************
 * @name: create_node
 * @brief: 创建一个新的链表节点
 * @param {int} value - 节点的值
 * @return {struct node*} - 新创建的节点
 * @date: 2024-08-03 14:51:53
 * @version: 1.0
 *****************************************************************************************************************************************************************/
struct node *create_node(int value) {
  struct node *new_node = malloc(sizeof(struct node));
  if (new_node == NULL) {
    printf("创建新节点失败！\n");
    exit(1);
  }
  new_node->value = value;
  INIT_LIST_HEAD(&new_node->list);
  return new_node;
}

/****************************************************************************************************************************************************************
 * @name: add_node_head
 * @brief: 将新节点添加到链表头部
 * @param {struct list_head*} head - 链表头
 * @param {int} value - 节点的值
 * @return {void}
 * @date: 2024-08-03 14:52:03
 * @version: 1.0
 *****************************************************************************************************************************************************************/
void add_node_head(struct list_head *head, int value) {
  struct node *new_node = create_node(value);
  list_add(&new_node->list, head);
}

/****************************************************************************************************************************************************************
 * @name: add_node_tail
 * @brief: 将新节点添加到链表尾部
 * @param {struct list_head*} head - 链表头
 * @param {int} value - 节点的值
 * @return {void}
 * @date: 2024-08-03 14:52:10
 * @version: 1.0
 *****************************************************************************************************************************************************************/
void add_node_tail(struct list_head *head, int value) {
  struct node *new_node = create_node(value);
  list_add_tail(&new_node->list, head);
}

/****************************************************************************************************************************************************************
 * @name: print_list_forward
 * @brief: 正向打印链表
 * @param {struct list_head*} head - 链表头
 * @return {void}
 * @date: 2024-08-03 14:52:18
 * @version: 1.0
 *****************************************************************************************************************************************************************/
void print_list_forward(struct list_head *head) {
  struct list_head *pos;
  struct node *entry;
  for (pos = (head)->next; pos != (head); pos = pos->next) {
    entry = ((struct node *)((char *)(pos) -
                             ((size_t) & ((struct node *)0)->list)));
    printf("%p\n", (char *)pos);
    printf("%u\n", (unsigned int)&((struct node *)NULL)->list);
    printf("%d\n", entry->value);
  }
}

/****************************************************************************************************************************************************************
 * @name: print_list_backward
 * @brief: 反向打印链表
 * @param {struct list_head*} head - 链表头
 * @return {void}
 * @date: 2024-08-03 14:52:27
 * @version: 1.0
 *****************************************************************************************************************************************************************/
void print_list_backward(struct list_head *head) {
  struct list_head *pos;
  struct node *entry;
  LIST_FOR_EACH_PREV(pos, head) {
    entry = LIST_ENTRY(pos, struct node, list);
    printf("%d\n", entry->value);
  }
}

/****************************************************************************************************************************************************************
 * @name: main
 * @brief: 主函数，演示链表操作
 * @param {int} argc - 参数数量
 * @param {const char**} argv - 参数数组
 * @return {int} - 程序返回状态
 * @date: 2024-08-03 14:52:36
 * @version: 1.0
 *****************************************************************************************************************************************************************/
int main(int argc, const char *argv[]) {
  LIST_HEAD(head); // 定义并初始化链表头

  // 添加节点到链表尾部
  add_node_tail(&head, 10);
  add_node_tail(&head, 20);
  add_node_tail(&head, 30);
  add_node_tail(&head, 40);
  add_node_tail(&head, 50);

  // 正向打印链表
  printf("正向打印链表:\n");
  print_list_forward(&head);

  // 反向打印链表
  printf("反向打印链表:\n");
  print_list_backward(&head);
  
  return 0;
}
